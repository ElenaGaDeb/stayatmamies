<section class="main-container">
  <div class="container">
    <div class="row">

     <% if policy(@profile).edit? %>
     <aside class="col-lg-4 col-xl-3 ml-xl-auto">
      <div class="sidebar">
        <!-- <div class="block clearfix"> -->
        <h3 class="title">My tools</h3>
        <div class="separator-2"></div>
        <%= link_to "Update my profile's info", edit_profile_path(@profile) %>
        <br>
        <% if @profile.user.apartment == nil && @profile.profile_type == "host" %>
        <%= link_to "Add your apartment", new_apartment_path %>
        <% end %>
        <!-- bookings -->
        <% if @profile.profile_type == "host" && @profile.user.apartment %>

        <% @profile.user.apartment.bookings.each do |booking| %>
          <%= booking.user.profile.first_name %>
          <%= booking.start_date %>
          <%= booking.end_date %>
          <%= booking.status %>
        <% if  booking.status == 'pending' %>
          <%= simple_form_for([booking.apartment, booking]) do |f| %>
          <%= f.hidden_field :status, value: 'Accepted' %>
          <%= f.button :submit, 'Accept', method: :patch %>
        <% end %>

        <%= simple_form_for([booking.apartment, booking]) do |f| %>
          <%= f.hidden_field :status, value: 'Rejected' %>
          <%= f.button :submit, 'Reject', method: :put %>
        <% end %>
        <% end %>
        <% end %>
        <% end %>

        <% if @profile.profile_type == "student" && @profile.user.bookings != nil %>
        <% @profile.user.bookings.each do |booking| %>
        <%= booking.apartment.user.profile.first_name %>
        <%= booking.start_date %>
        <%= booking.end_date %>
        <%= booking.status %>
        <% end %>
        <% end %>

      </div>


    </aside>
    <% end %>

    <!-- main start -->
    <!-- ================ -->
    <div class="main col-12">

      <!-- page-title start -->
      <!-- ================ -->
      <h1 class="page-title text-center"><%= @profile.first_name.capitalize %>'s Profile</h1>
      <span>
        <i class="fa fa-star text-default"></i>
        <i class="fa fa-star text-default"></i>
        <i class="fa fa-star text-default"></i>
        <i class="fa fa-star text-default"></i>
        <i class="fa fa-star"></i>
      </span>
      <p class="large text-center"><%= @profile.short_description %></p>

      <div class="separator-2"></div>
      <!-- page-title end -->

      <div class="row">
        <div class="col-lg-4">
          <% if  @profile.photo? %>
          <%= cl_image_tag @profile.photo.path, width: 400, height: 400, crop: :fill %>
          <% else %>
          <%= image_tag "no-photo.png", width: 400, height: 400, crop: :fill %>
          <% end %>
        </div>
        <div class="col-lg-8 col-xl-7 pv-30">
          <h2 class="mt-4">Description</h2>
          <p><%= @profile.age%> years old, from<%= @profile.city_from.capitalize %></p>

          <p><%= @profile.detailed_description %></p>
          <h4 class="space-top">My personality</h4>
          <hr>
          <dl class="row">
            <% if @characteristics.count != 0 %>
            <% @characteristics.each  do |char| %>
            <dd class="col-sm-9">
              <%= char.name %>
            </dd>
            <% end %>
            <% else %>
            <dt>This user hasn't added any more info yet</dt>
            <% end %>
          </dl>
          <hr>


        </div>
      </div>
    </div>

      <section class="pv-30 light-gray-bg">
        <div class="container">
          <div class="row">
            <div class="col-lg-8">
              <h2 class="title"><%= @reviews_for.count %> reviews</h2>
              <div class="separator-2"></div>
              <!-- comments start -->
              <div class="comments margin-clear space-top">
                <% if @reviews_for.blank? %>
                  Be the first to leave a review on <%= @profile.first_name %>'s profile :)
                <% else %>
                  <% @reviews_for.reverse.each do |review| %>
                  <!-- comment start -->
                  <%= render 'reviews/show', review: review %>
                  <!-- comment end -->
                  <% end %>
                <% end %>
              </div>
              <!-- comments end -->

              <!-- comments form start -->
              <% unless @reviews_for.map { |r| r.by_user_id }.include?(current_user.id) %>
                <%= render 'reviews/form', profile: @profile, review: @review %>
              <% end %>
              <!-- comments form end -->
            </div>

          <!-- sidebar start -->
          <!-- ================ -->



      </div>
    </div>
  </section>
</div>
</div>
